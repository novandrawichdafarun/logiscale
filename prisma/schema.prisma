generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "mysql"
}

model organization {
  id          String        @id
  name        String
  product     product[]
  supplier    supplier[]
  transaction transaction[]
}

model product {
  id             String        @id
  organizationId String
  supplierId     String
  name           String
  sku            String
  currentStock   Int           @default(0)
  price          Decimal
  safetyStock    Int           @default(0)
  reorderPoint   Int           @default(0)
  organization   organization  @relation(fields: [organizationId], references: [id], map: "Product_organizationId_fkey")
  supplier       supplier      @relation(fields: [supplierId], references: [id], map: "Product_supplierId_fkey")
  transaction    transaction[]
  purchaseOrders PurchaseOrder[]

  @@unique([organizationId, sku], map: "Product_organizationId_sku_key")
  @@index([organizationId], map: "Product_organizationId_idx")
  @@index([supplierId], map: "Product_supplierId_fkey")
}

model supplier {
  id             String       @id
  organizationId String
  name           String
  leadTimeDays   Int          @default(7)
  product        product[]
  organization   organization @relation(fields: [organizationId], references: [id], map: "Supplier_organizationId_fkey")

  @@index([organizationId], map: "Supplier_organizationId_idx")
}

model transaction {
  id             String           @id
  organizationId String
  productId      String
  type           transaction_type
  quantity       Int
  createdAt      DateTime         @default(now())
  organization   organization     @relation(fields: [organizationId], references: [id], map: "Transaction_organizationId_fkey")
  product        product          @relation(fields: [productId], references: [id], map: "Transaction_productId_fkey")

  @@index([organizationId], map: "Transaction_organizationId_fkey")
  @@index([productId, createdAt], map: "Transaction_productId_createdAt_idx")
}

model PurchaseOrder {
  id        String   @id @default(uuid())
  productId String
  quantity  Int
  status    String   @default("PENDING") // PENDING, SENT, RECEIVED
  createdAt DateTime @default(now())
  
  product   product  @relation(fields: [productId], references: [id])
}

enum transaction_type {
  INBOUND
  OUTBOUND
  ADJUSTMENT
}
